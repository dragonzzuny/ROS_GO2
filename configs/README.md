# Map Configurations

μ΄ λ””λ ‰ν† λ¦¬λ” λ‹¤μ–‘ν• μμ°° λ§µ μ„¤μ •μ„ ν¬ν•¨ν•©λ‹λ‹¤.
κ° λ§µμ€ μ„λ΅ λ‹¤λ¥Έ ν™κ²½μ„ λ€ν‘ν•μ—¬ μ •μ±…μ μΌλ°ν™” μ„±λ¥μ„ ν–¥μƒμ‹ν‚µλ‹λ‹¤.

## π“ μ‚¬μ© κ°€λ¥ν• λ§µ

### 1. `default.yaml` - κΈ°λ³Έ ν…μ¤νΈ λ§µ
- **ν¬κΈ°**: 50m Γ— 50m (μ•½ 756ν‰)
- **μμ°° ν¬μΈνΈ**: 4κ° (μ •μ‚¬κ°ν• ν¨ν„΄)
- **μ©λ„**: λΉ λ¥Έ ν…μ¤νΈ λ° ν”„λ΅ν† νƒ€μ΄ν•‘
- **νΉμ§•**: κ°„λ‹¨ν•κ³  λ€μΉ­μ μΈ κµ¬μ΅°

```yaml
# μ‚¬μ© μμ‹
python scripts/train.py --config configs/default.yaml
```

---

### 2. `map_large_square.yaml` - ν° μ •μ‚¬κ°ν• λ§µ
- **ν¬κΈ°**: 100m Γ— 100m (μ•½ 3,025ν‰)
- **μμ°° ν¬μΈνΈ**: 12κ° (μ™Έκ³½ 8κ° + λ‚΄λ¶€ 4κ°)
- **μ©λ„**: λ„“μ€ κ³µκ°„ μμ°° ν•™μµ
- **νΉμ§•**:
  - λ„“μ€ κ°λ°© κ³µκ°„
  - μ™Έκ³½ + λ‚΄λ¶€ μμ°° ν¨ν„΄
  - κΈ΄ μ΄λ™ κ±°λ¦¬
  - λ†’μ€ μ΄λ²¤νΈ λ°μƒλ¥  (12ν/μ—ν”Όμ†λ“)

```yaml
# μ„¤μ • ν•μ΄λΌμ΄νΈ
robot_max_velocity: 2.0  # λ„“μ€ κ³µκ°„μ΄λΌ λΉ λ¥Έ μ†λ„
event_generation_rate: 12.0
max_episode_time: 900.0  # 15λ¶„
```

---

### 3. `map_corridor.yaml` - λ³µλ„ν• λ§µ
- **ν¬κΈ°**: 120m Γ— 30m (μ•½ 1,090ν‰)
- **μμ°° ν¬μΈνΈ**: 10κ° (μ§μ„  λ°°μΉ)
- **μ©λ„**: 1μ°¨μ› κΈ΄ κ²½λ΅ μµμ ν™”
- **νΉμ§•**:
  - κΈ΄ μ§μ„  λ³µλ„
  - λ‹¨μν• κ²½λ΅ κµ¬μ΅°
  - μ…κµ¬/μ¶κµ¬ μ¤‘μ”λ„ λ†’μ

```yaml
# μ„¤μ • ν•μ΄λΌμ΄νΈ
patrol_point_priorities:
  - 1.5  # μ…κµ¬ (μ¤‘μ”)
  - 1.0  # μ¤‘κ°„
  - ...
  - 1.5  # μ¶κµ¬ (μ¤‘μ”)
```

---

### 4. `map_l_shaped.yaml` - Lμν• κ±΄λ¬Ό
- **ν¬κΈ°**: 80m Γ— 80m (μ•½ 1,450ν‰)
- **μμ°° ν¬μΈνΈ**: 10κ° (Lμ ν¨ν„΄)
- **μ©λ„**: λΉ„μ •ν• κ³µκ°„ ν•™μµ
- **νΉμ§•**:
  - Lμ ν•νƒ λ³µμ΅ν• κµ¬μ΅°
  - μ½”λ„ κµ¬μ—­ μ¤‘μ”λ„ λ†’μ
  - λ‹¤μ–‘ν• κ²½λ΅ μ„ νƒ κ°€λ¥

```yaml
# μ„¤μ • ν•μ΄λΌμ΄νΈ
patrol_points:
  # Lμ κ°€λ΅ λ¶€λ¶„
  - [10.0, 10.0]
  - [25.0, 10.0]
  - [40.0, 10.0]
  ...
  # Lμ μ„Έλ΅ λ¶€λ¶„
  - [40.0, 40.0]
  - [40.0, 55.0]
  ...
```

---

### 5. `map_office_building.yaml` - μ‚¬λ¬΄μ‹¤ κ±΄λ¬Ό
- **ν¬κΈ°**: 90m Γ— 70m (μ•½ 1,900ν‰)
- **μμ°° ν¬μΈνΈ**: 14κ° (λ΅λΉ„, λ³µλ„, μ‚¬λ¬΄μ‹¤ λ“±)
- **μ©λ„**: λ³µμ΅ν• μ‹¤λ‚΄ κ³µκ°„
- **νΉμ§•**:
  - μ—¬λ¬ κµ¬μ—­ (λ΅λΉ„, μ‚¬λ¬΄μ‹¤, νμμ‹¤, λΉ„μƒκµ¬)
  - κµ¬μ—­λ³„ μ¤‘μ”λ„ μ°¨λ“±
  - λ†’μ€ μ΄λ²¤νΈ λ°μƒλ¥  (μ‚¬λμ΄ λ§μ)
  - μ•μ „ μ¤‘μ”λ„ λ†’μ

```yaml
# μ„¤μ • ν•μ΄λΌμ΄νΈ
patrol_point_priorities:
  - 2.0  # μ •λ¬Έ (λ§¤μ° μ¤‘μ”)
  - 1.8  # λ΅λΉ„
  - 1.6  # λΉ„μƒκµ¬
  - 1.5  # μ¤‘μ•™ κµμ°¨λ΅
  - ...

robot_max_velocity: 1.2  # μ‹¤λ‚΄λΌμ„ λλ¦¬κ²
collision_penalty: -150.0  # μ‚¬λ λ§μ•„μ„ μ¶©λ νλ„ν‹° ν¬κ²
```

---

### 6. `map_campus.yaml` - μ•Όμ™Έ μΊ νΌμ¤/λ‹¨μ§€
- **ν¬κΈ°**: 150m Γ— 120m (μ•½ 5,445ν‰)
- **μμ°° ν¬μΈνΈ**: 16κ° (κ±΄λ¬Ό, κ΄‘μ¥, μ£Όμ°¨μ¥ λ“±)
- **μ©λ„**: λ„“μ€ μ•Όμ™Έ κ³µκ°„, λ¶κ·μΉ™ν• λ°°μΉ
- **νΉμ§•**:
  - λ§¤μ° λ„“μ€ κ³µκ°„
  - λ¶κ·μΉ™ν• ν¬μΈνΈ λ°°μΉ
  - μ•Όμ™ΈλΌμ„ λΉ λ¥Έ μ†λ„ κ°€λ¥
  - κΈ΄ μ—ν”Όμ†λ“ (25λ¶„)

```yaml
# μ„¤μ • ν•μ΄λΌμ΄νΈ
map_width: 150.0
map_height: 120.0
robot_max_velocity: 2.5  # μ•Όμ™ΈλΌμ„ λΉ λ¥΄κ²
event_generation_rate: 18.0  # λ„“μ–΄μ„ μ΄λ²¤νΈ λ§μ
max_episode_time: 1500.0  # 25λ¶„
```

---

### 7. `map_warehouse.yaml` - μ°½κ³ /λ¬Όλ¥μ„Όν„°
- **ν¬κΈ°**: 140m Γ— 100m (μ•½ 4,235ν‰)
- **μμ°° ν¬μΈνΈ**: 12κ° (ν•μ—­μ¥, μ €μ¥ κµ¬μ—­ λ“±)
- **μ©λ„**: λ„“κ³  κ°λ°©λ μ‚°μ—… κ³µκ°„
- **νΉμ§•**:
  - ν•μ—­μ¥ κµ¬μ—­ μ¤‘μ”
  - μ¤‘μ•™ κµμ°¨λ΅ λ§¤μ° μ¤‘μ”
  - μ‘μ—… μ΄λ²¤νΈ λ§μ
  - μ¥λΉ„ μ¶©λ μ„ν—

```yaml
# μ„¤μ • ν•μ΄λΌμ΄νΈ
patrol_point_priorities:
  - 1.5  # ν•μ—­μ¥λ“¤ (μ¤‘μ”)
  - 1.8  # μ¤‘μ•™ κµμ°¨λ΅ (λ§¤μ° μ¤‘μ”)

collision_penalty: -120.0  # μ¥λΉ„ μ¶©λ μ„ν—
```

---

## π― λ§µ μ„ νƒ κ°€μ΄λ“

### ν•™μµ λ©μ λ³„ μ¶”μ²

| λ©μ  | μ¶”μ² λ§µ | μ΄μ  |
|------|---------|------|
| **λΉ λ¥Έ ν…μ¤νΈ** | `default.yaml` | μ‘κ³  κ°„λ‹¨, λΉ λ¥Έ ν•™μµ |
| **ν‘μ¤€ ν•™μµ** | `map_large_square.yaml` | κ· ν•μ΅ν ν¬κΈ°μ™€ λ³µμ΅λ„ |
| **λ³µμ΅ν• ν™κ²½** | `map_office_building.yaml` | μ—¬λ¬ κµ¬μ—­, λ†’μ€ μ΄λ²¤νΈ |
| **λ„“μ€ κ³µκ°„** | `map_campus.yaml` | λ§¤μ° ν° λ§µ, κΈ΄ μ΄λ™ |
| **μΌλ°ν™” ν•™μµ** | **λ¨λ“  λ§µ νΌν•©** | λ‹¤μ–‘ν• μ‹λ‚λ¦¬μ¤ |

### λ§µ λ‚μ΄λ„

```
μ‰¬μ›€  β†β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β†’  μ–΄λ ¤μ›€

default  β†’  corridor  β†’  large_square  β†’  l_shaped  β†’  office  β†’  warehouse  β†’  campus
(4μ )     (10μ )        (12μ )          (10μ )       (14μ )     (12μ )        (16μ )
```

---

## π€ μ‚¬μ© λ°©λ²•

### 1. λ‹¨μΌ λ§µμΌλ΅ ν•™μµ

```bash
# κΈ°λ³Έ λ§µ
python scripts/train.py --config configs/default.yaml

# ν° μ •μ‚¬κ°ν• λ§µ
python scripts/train.py --config configs/map_large_square.yaml

# μ‚¬λ¬΄μ‹¤ λ§µ
python scripts/train.py --config configs/map_office_building.yaml
```

### 2. μ—¬λ¬ λ§µμΌλ΅ μΌλ°ν™” ν•™μµ (κ¶μ¥!)

```bash
# κΈ°λ³Έ: λ¨λ“  λ§µ λλ¤ μ„ νƒ
python scripts/train_multi_map.py

# νΉμ • λ§µλ“¤λ§ μ„ νƒ
python scripts/train_multi_map.py \
  --maps configs/map_large_square.yaml configs/map_office_building.yaml

# μ»¤λ¦¬νλΌ ν•™μµ (μ‰¬μ΄ λ§µ β†’ μ–΄λ ¤μ΄ λ§µ)
python scripts/train_multi_map.py --map-mode curriculum

# μμ°¨ ν•™μµ (λ§µμ„ μμ„λ€λ΅)
python scripts/train_multi_map.py --map-mode sequential
```

### 3. μ»¤λ²„λ¦¬μ§€ μ‹κ°ν™”

```bash
# ν•™μµλ λ¨λΈλ΅ μ»¤λ²„λ¦¬μ§€ ν™•μΈ
python scripts/visualize_coverage.py \
  --model checkpoints/final.pth \
  --episodes-per-map 20

# λλ¤ μ •μ±…μΌλ΅ μ»¤λ²„λ¦¬μ§€ ν™•μΈ (baseline)
python scripts/visualize_coverage.py --episodes-per-map 20
```

### 4. μΌλ°ν™” μ„±λ¥ ν‰κ°€

```bash
# μ—¬λ¬ λ§µμ—μ„ μ„±λ¥ λΉ„κµ
python scripts/evaluate_generalization.py \
  --model checkpoints/final.pth \
  --episodes 50 \
  --save-json

# κ²°κ³Ό: outputs/generalization/ λ””λ ‰ν† λ¦¬μ— μ €μ¥
# - generalization_results.json
# - generalization_comparison.png
# - return_distribution.png
```

---

## βοΈ μ»¤μ¤ν…€ λ§µ λ§λ“¤κΈ°

### κΈ°λ³Έ ν…ν”λ¦Ώ

```yaml
# configs/my_custom_map.yaml

env:
  # λ§µ ν¬κΈ° (λ―Έν„°)
  map_width: 60.0
  map_height: 50.0

  # μμ°° ν¬μΈνΈ (x, y μΆν‘)
  patrol_points:
    - [10.0, 10.0]
    - [30.0, 10.0]
    - [50.0, 10.0]
    - [50.0, 40.0]
    - [30.0, 40.0]
    - [10.0, 40.0]

  # κ° ν¬μΈνΈμ μ¤‘μ”λ„ (1.0 = λ³΄ν†µ, 2.0 = λ§¤μ° μ¤‘μ”)
  patrol_point_priorities:
    - 1.5  # P0
    - 1.0  # P1
    - 1.0  # P2
    - 1.3  # P3
    - 1.0  # P4
    - 1.2  # P5

  # μ—ν”Όμ†λ“ μ„¤μ •
  max_episode_steps: 250
  max_episode_time: 800.0

  # μ΄λ²¤νΈ λ°μƒ
  event_generation_rate: 8.0
  event_min_urgency: 0.3
  event_max_urgency: 1.0

  # λ΅λ΄‡ μ„¤μ •
  robot_max_velocity: 1.5
  robot_battery_capacity: 150.0

  # ν›„λ³΄ μ „λµ (ν•­μƒ 6κ°)
  num_candidates: 6
  candidate_strategies:
    - "keep_order"
    - "nearest_first"
    - "most_overdue_first"
    - "overdue_eta_balance"
    - "risk_weighted"
    - "balanced_coverage"

reward:
  # λ³΄μƒ κ°€μ¤‘μΉ
  w_event: 1.0
  w_patrol: 0.6
  w_safety: 2.0
  w_efficiency: 0.12

  # μ΄λ²¤νΈ λ³΄μƒ
  event_response_bonus: 55.0
  event_delay_penalty_rate: 0.55

  # μμ°° λ³΄μƒ
  patrol_gap_penalty_rate: 0.12
  patrol_visit_bonus: 2.5

  # μ•μ „ νλ„ν‹°
  collision_penalty: -100.0
  nav_failure_penalty: -20.0

  # ν¨μ¨μ„±
  distance_penalty_rate: 0.01
```

### μ‹¤μ  κ±΄λ¬Ό μ μ© μμ‹

```yaml
# configs/my_building.yaml
# μ: μ„μΈλ€ 302λ™ 1μΈµ (μ‹¤μ  ν¬κΈ° μΈ΅μ • ν›„)

env:
  map_width: 85.0
  map_height: 45.0

  patrol_points:
    - [10.0, 10.0]   # μ •λ¬Έ
    - [25.0, 10.0]   # λ΅λΉ„
    - [40.0, 10.0]   # λ³µλ„1
    - [55.0, 10.0]   # λ³µλ„2
    - [70.0, 10.0]   # λΉ„μƒκµ¬
    - [70.0, 25.0]   # κ³„λ‹¨μ‹¤
    - [70.0, 35.0]   # μ‹¤ν—μ‹¤A
    - [55.0, 35.0]   # μ‹¤ν—μ‹¤B
    - [40.0, 35.0]   # μ‚¬λ¬΄μ‹¤
    - [25.0, 35.0]   # νμμ‹¤
    - [10.0, 35.0]   # ν΄κ²μ‹¤

  patrol_point_priorities:
    - 2.0  # μ •λ¬Έ (λ§¤μ° μ¤‘μ”)
    - 1.8  # λ΅λΉ„
    - 1.0  # μΌλ° λ³µλ„
    - 1.0
    - 1.6  # λΉ„μƒκµ¬ (μ¤‘μ”)
    - 1.3  # κ³„λ‹¨μ‹¤
    - 1.2  # μ‹¤ν—μ‹¤λ“¤
    - 1.2
    - 1.1  # μ‚¬λ¬΄μ‹¤
    - 1.0  # νμμ‹¤
    - 0.8  # ν΄κ²μ‹¤ (λ μ¤‘μ”)

  robot_max_velocity: 1.0  # μ‹¤λ‚΄λΌμ„ λλ¦¬κ²
  event_generation_rate: 12.0
  max_episode_time: 1200.0  # 20λ¶„

reward:
  w_event: 1.2  # μ‹¤λ‚΄λΌμ„ μ΄λ²¤νΈ μ¤‘μ”
  w_safety: 2.5  # μ‚¬λ λ§μ•„μ„ μ•μ „ λ§¤μ° μ¤‘μ”
  collision_penalty: -150.0
```

---

## π“ λ§µ λΉ„κµν‘

| λ§µ | ν¬κΈ° (mΒ²) | ν‰μ | ν¬μΈνΈ | λ‚μ΄λ„ | μ΄λ²¤νΈμ¨ | μ—ν”Όμ†λ“ μ‹κ°„ | νΉμ§• |
|----|----------|------|--------|--------|----------|--------------|------|
| `default` | 50Γ—50 | 756ν‰ | 4 | β­ | 5.0 | 10λ¶„ | κΈ°λ³Έ ν…μ¤νΈ |
| `large_square` | 100Γ—100 | 3,025ν‰ | 12 | β­β­β­ | 12.0 | 15λ¶„ | λ„“μ€ κ³µκ°„ |
| `corridor` | 120Γ—30 | 1,090ν‰ | 10 | β­β­ | 8.0 | 13λ¶„ | 1μ°¨μ› κ²½λ΅ |
| `l_shaped` | 80Γ—80 | 1,450ν‰ | 10 | β­β­β­ | 10.0 | 14λ¶„ | λΉ„μ •ν• κ³µκ°„ |
| `office_building` | 90Γ—70 | 1,900ν‰ | 14 | β­β­β­β­ | 14.0 | 16λ¶„ | λ³µμ΅ν• μ‹¤λ‚΄ |
| `warehouse` | 140Γ—100 | 4,235ν‰ | 12 | β­β­β­β­ | 15.0 | 20λ¶„ | μ‚°μ—… μ‹μ„¤ |
| `campus` | 150Γ—120 | 5,445ν‰ | 16 | β­β­β­β­β­ | 18.0 | 25λ¶„ | μ•Όμ™Έ λ€κ·λ¨ |

---

## π’΅ ν & λ¨λ²” μ‚¬λ΅€

### 1. λ§µ ν¬κΈ° μ„ νƒ
- **100ν‰ μ΄μƒ**: μλ―Έμλ” μμ°° μ‹λ‚λ¦¬μ¤
- **λ„λ¬΄ μ‘μΌλ©΄**: ν•™μµμ΄ μ‰½μ§€λ§ λΉ„ν„μ‹¤μ 
- **λ„λ¬΄ ν¬λ©΄**: ν•™μµ μ‹κ°„ λ§¤μ° κΈΈμ–΄μ§

### 2. μμ°° ν¬μΈνΈ κ°μ
- **μµμ† 2κ° μ΄μƒ** ν•„μ”
- **4-12κ°**: μ μ ν• λ²”μ„
- **15κ° μ΄μƒ**: ν•™μµ μ–΄λ ¤μ›€, ν›„λ³΄ μ μ¦κ°€ κ³ λ ¤

### 3. μ°μ„ μμ„ μ„¤μ •
- **μ…κµ¬/μ¶κµ¬**: 1.5-2.0 (μ¤‘μ”)
- **μΌλ° κµ¬μ—­**: 1.0 (λ³΄ν†µ)
- **λ μ¤‘μ”ν• κ³³**: 0.7-0.9

### 4. μ΄λ²¤νΈ λ°μƒλ¥ 
- **λ§µ ν¬κΈ°μ— λΉ„λ΅€**ν•΄μ„ μ„¤μ •
- μ‘μ€ λ§µ: 3-5ν/μ—ν”Όμ†λ“
- ν° λ§µ: 10-20ν/μ—ν”Όμ†λ“

### 5. λ΅λ΄‡ μ†λ„
- **μ‹¤λ‚΄**: 1.0-1.5 m/s
- **μ•Όμ™Έ**: 1.5-2.5 m/s
- μ‹¤μ  Go2 μµλ€ μ†λ„: ~3.5 m/s

---

## π” λ¬Έμ  ν•΄κ²°

### "num_candidates must match number of strategies"
β†’ `num_candidates: 6`μΌλ΅ μ„¤μ •ν•κ³  `candidate_strategies`μ— μ •ν™•ν 6κ° μ „λµ λ‚μ—΄

### "Must have at least 2 patrol points"
β†’ `patrol_points`μ— μµμ† 2κ° μ΄μƒμ μΆν‘ μ¶”κ°€

### "Must have priority for each patrol point"
β†’ `patrol_point_priorities` κ°μ = `patrol_points` κ°μ

### ν•™μµμ΄ λ„λ¬΄ λλ¦Ό
β†’ λ” μ‘μ€ λ§µμΌλ΅ μ‹μ‘ν•κ±°λ‚ `max_episode_steps` μ¤„μ΄κΈ°

---

## π“ μ°Έκ³  μλ£

- **ν™κ²½ μ„¤μ • μ½”λ“**: `src/rl_dispatch/core/config.py`
- **λ§µ μ‹κ°ν™”**: `scripts/visualize_map.py`
- **μ»¤λ²„λ¦¬μ§€ λ¶„μ„**: `scripts/visualize_coverage.py`
- **μΌλ°ν™” ν‰κ°€**: `scripts/evaluate_generalization.py`

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-12-29
**μ‘μ„±μ**: λ°•μ©μ¤€ (YJP)
